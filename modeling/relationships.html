

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Отношения &mdash; Документация Entity Framework Core 1.0.0</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  

  
    <link rel="top" title="Документация Entity Framework Core 1.0.0" href="../index.html"/>
        <link rel="up" title="Создание модели" href="index.html"/>
        <link rel="next" title="Индексы" href="indexes.html"/>
        <link rel="prev" title="Скрытые свойства" href="shadow-properties.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Entity Framework Core
          

          
          </a>

          
            
            
              <div class="version">
                1.0.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../intro.html">Entity Framework Core</a></li>
<li class="toctree-l1"><a class="reference internal" href="../platforms/index.html">Приступая к работе</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Создание модели</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="included-types.html">Включение &amp; исключение типов</a></li>
<li class="toctree-l2"><a class="reference internal" href="included-properties.html">Включение &amp; исключение свойств</a></li>
<li class="toctree-l2"><a class="reference internal" href="keys.html">Ключи (первичные)</a></li>
<li class="toctree-l2"><a class="reference internal" href="generated-properties.html">Генерирование свойств</a></li>
<li class="toctree-l2"><a class="reference internal" href="required-optional.html">Обязательные/необязательные свойства</a></li>
<li class="toctree-l2"><a class="reference internal" href="max-length.html">Максимальная длина</a></li>
<li class="toctree-l2"><a class="reference internal" href="concurrency.html">Маркеры параллелизма (Concurrency Tokens)</a></li>
<li class="toctree-l2"><a class="reference internal" href="shadow-properties.html">Скрытые свойства</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Отношения</a><ul class="simple">
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="indexes.html">Индексы</a></li>
<li class="toctree-l2"><a class="reference internal" href="alternate-keys.html">Альтернативные ключи</a></li>
<li class="toctree-l2"><a class="reference internal" href="inheritance.html">Наследование</a></li>
<li class="toctree-l2"><a class="reference internal" href="backing-field.html">Резервные поля</a></li>
<li class="toctree-l2"><a class="reference internal" href="relational/index.html">Моделирование Реляционной базы данных</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../querying/index.html">Запрос данных</a></li>
<li class="toctree-l1"><a class="reference internal" href="../saving/index.html">Сохранение данных</a></li>
<li class="toctree-l1"><a class="reference internal" href="../efcore-vs-ef6/index.html">EF Core vs. EF6.x</a></li>
<li class="toctree-l1"><a class="reference internal" href="../providers/index.html">Провайдеры баз данных</a></li>
<li class="toctree-l1"><a class="reference internal" href="../miscellaneous/index.html">Разное</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">Entity Framework Core</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="index.html">Создание модели</a> &raquo;</li>
      
    <li>Отношения</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="admonition attention">
<p class="first admonition-title">Внимание</p>
<p class="last">Эта документация для EF Core. Для EF6.x и более ранних версий смотрите <a class="reference external" href="http://msdn.com/data/ef">http://msdn.com/data/ef</a>.</p>
</div>
<div class="section" id="id1">
<h1><a class="toc-backref" href="#id17">Отношения</a><a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h1>
<p>Отношения определяют, как две сущности связаны друг с другом. В реляционной базе данных это представлено ограничением при помощи внешнего ключа.</p>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">Большинство примеров в этой статье для демонстрации концепции используют отношение <strong>один-ко-многим</strong>. Примеры отношений <strong>один-к-одному</strong> и <strong>многие-ко-многим</strong> смотрите в разделе <a class="reference internal" href="#id14">Другие модели отношений</a> в конце статьи.</p>
</div>
<div class="contents topic" id="id2">
<p class="topic-title first">В этой статье:</p>
<ul class="simple">
<li><a class="reference internal" href="#id1" id="id17">Отношения</a><ul>
<li><a class="reference internal" href="#id3" id="id18">Значение терминов</a></li>
<li><a class="reference internal" href="#id4" id="id19">Соглашения</a><ul>
<li><a class="reference internal" href="#id5" id="id20">Полностью определенные отношения</a></li>
<li><a class="reference internal" href="#id6" id="id21">Без свойства внешнего ключа</a></li>
<li><a class="reference internal" href="#id7" id="id22">Простое навигационное свойство</a></li>
<li><a class="reference internal" href="#id8" id="id23">Каскадное удаление</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id9" id="id24">Аннотации данных</a><ul>
<li><a class="reference internal" href="#foreignkey" id="id25">[ForeignKey]</a></li>
<li><a class="reference internal" href="#inverseproperty" id="id26">[InverseProperty]</a></li>
</ul>
</li>
<li><a class="reference internal" href="#fluent-api" id="id27">Fluent API</a><ul>
<li><a class="reference internal" href="#id10" id="id28">Простое навигационное свойство</a></li>
<li><a class="reference internal" href="#id11" id="id29">Внешний ключ</a></li>
<li><a class="reference internal" href="#id12" id="id30">Главный ключ</a></li>
<li><a class="reference internal" href="#required" id="id31">Required</a></li>
<li><a class="reference internal" href="#id13" id="id32">Каскадное удаление</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id14" id="id33">Другие модели отношений</a><ul>
<li><a class="reference internal" href="#id15" id="id34">Один-к-одному</a></li>
<li><a class="reference internal" href="#id16" id="id35">Многие-ко-многим</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="id3">
<h2><a class="toc-backref" href="#id18">Значение терминов</a><a class="headerlink" href="#id3" title="Ссылка на этот заголовок">¶</a></h2>
<dl class="docutils">
<dt>Есть целый ряд терминов, используемых для описания отношений</dt>
<dd><ul class="first last simple">
<li><strong>Зависимая сущность:</strong> Это объект, который содержит свойство внешнего ключа(ключей). В отношениях иногда упоминается как «потомок».</li>
<li><strong>Основная сущность:</strong> Это объект, который содержит свойства первичного / альтернативного ключа(ключей). В отношениях иногда упоминается как «родитель».</li>
<li><strong>Внешний ключ:</strong> Свойство(свойства) в зависимой сущности, которое используется для хранения значений свойства главного ключа сущности, к которой относится объект.</li>
<li><strong>Главный ключ:</strong> Свойство(свойства), которое однозначно идентифицирует основную сущность. Это может быть первичный ключ или альтернативный ключ.</li>
<li><strong>Навигационное свойство:</strong> это свойство, определяющее основную и/или зависимую сущность, которое содержит ссылку(ссылки) на соответственную сущность(сущности).</li>
<li><strong>Коллекция навигационных свойств:</strong> это навигационное свойство, содержащее ссылки на несколько соответствующих сущностей.</li>
<li><strong>Ссылочное навигационное свойство:</strong> навигационное свойство, которое содержит ссылку на одну соответствующую сущность.</li>
<li><strong>Обратное навигационное свойство:</strong> При обсуждении конкретного свойство навигации, этот термин относится к навигационному свойству на другом конце отношений.</li>
</ul>
</dd>
<dt>Следующий код показывает отношение <strong>один-ко-многим</strong> между <code class="docutils literal"><span class="pre">Blog</span></code> и <code class="docutils literal"><span class="pre">Post</span></code></dt>
<dd><ul class="first last simple">
<li><code class="docutils literal"><span class="pre">Post</span></code> это зависимая сущность</li>
<li><code class="docutils literal"><span class="pre">Blog</span></code> это основная сущность</li>
<li><code class="docutils literal"><span class="pre">Post.BlogId</span></code> является внешним ключом</li>
<li><code class="docutils literal"><span class="pre">Blog.BlogId</span></code> это главный ключ (в данном случае это первичный ключ, а не альтернативный ключ)</li>
<li><code class="docutils literal"><span class="pre">Post.Blog</span></code> это ссылочное навигационное свойство</li>
<li><code class="docutils literal"><span class="pre">Blog.Posts</span></code> это коллекция навигационных свойств</li>
<li><code class="docutils literal"><span class="pre">Post.Blog</span></code> это обратное навигационное свойство сущности <code class="docutils literal"><span class="pre">Blog.Posts</span></code> (и наоборот)</li>
</ul>
</dd>
</dl>
<div class="highlight-c#"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="highlight"><pre><span></span>    <span class="k">public</span> <span class="k">class</span> <span class="nc">Blog</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="kt">int</span> <span class="n">BlogId</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">Url</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

        <span class="k">public</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Post</span><span class="p">&gt;</span> <span class="n">Posts</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">class</span> <span class="nc">Post</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="kt">int</span> <span class="n">PostId</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">Title</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">Content</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

        <span class="k">public</span> <span class="kt">int</span> <span class="n">BlogId</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="n">Blog</span> <span class="n">Blog</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="id4">
<h2><a class="toc-backref" href="#id19">Соглашения</a><a class="headerlink" href="#id4" title="Ссылка на этот заголовок">¶</a></h2>
<p>По соглашению, отношения будут созданы, если в типе обнаружено навигационное свойство. Свойство считается навигационным, если тип, на который оно указывает, не может быть отображен текущим поставщиком базы данных в виде скалярного типа.</p>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">Отношения, которые обнаруживаются по соглашению, всегда будут направлены ​​на первичный ключ основного объекта. Чтобы настроить таргетинг на альтернативный ключ, должна быть выполнена дополнительная конфигурация с использованием Fluent API.</p>
</div>
<div class="section" id="id5">
<h3><a class="toc-backref" href="#id20">Полностью определенные отношения</a><a class="headerlink" href="#id5" title="Ссылка на этот заголовок">¶</a></h3>
<dl class="docutils">
<dt>Наиболее распространенный паттерн отношений это наличие навигационных свойств, определенных на обоих концах отношений, а так же свойство внешнего ключа, определенное в классе зависимой сущности.</dt>
<dd><ul class="first last simple">
<li>Если между двумя типами найдена пара навигационных свойств, то они будут сконфигурированы как обратные навигационные свойства одного и того же отношения.</li>
<li>Если зависимый объект содержит свойство с именем <code class="docutils literal"><span class="pre">&lt;имя</span> <span class="pre">свойства</span> <span class="pre">первичного</span> <span class="pre">ключа&gt;</span></code>, <code class="docutils literal"><span class="pre">&lt;имя</span> <span class="pre">навигационного</span> <span class="pre">свойства&gt;&lt;имя</span> <span class="pre">свойства</span> <span class="pre">первичного</span> <span class="pre">ключа&gt;</span></code>, или <code class="docutils literal"><span class="pre">&lt;имя</span> <span class="pre">основной</span> <span class="pre">сущности&gt;&lt;имя</span> <span class="pre">свойства</span> <span class="pre">первичного</span> <span class="pre">ключа&gt;</span></code> то оно будет определено в качестве внешнего ключа..</li>
</ul>
</dd>
</dl>
<div class="highlight-c#"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="highlight"><pre><span></span>    <span class="k">public</span> <span class="k">class</span> <span class="nc">Blog</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="kt">int</span> <span class="n">BlogId</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">Url</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

<span class="hll">        <span class="k">public</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Post</span><span class="p">&gt;</span> <span class="n">Posts</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span>    <span class="p">}</span>

    <span class="k">public</span> <span class="k">class</span> <span class="nc">Post</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="kt">int</span> <span class="n">PostId</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">Title</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">Content</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

<span class="hll">        <span class="k">public</span> <span class="kt">int</span> <span class="n">BlogId</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class="hll">        <span class="k">public</span> <span class="n">Blog</span> <span class="n">Blog</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span>    <span class="p">}</span>
</pre></div>
</td></tr></table></div>
<div class="admonition attention">
<p class="first admonition-title">Внимание</p>
<p class="last">Если есть несколько навигационных свойств, определенных между двумя типами (т.е. есть более одной навигационной пары, которые указывают друг на друга), то в соответствии с соглашениями, не будет создано никаких отношений, и вам нужно будет вручную сконфигурировать их чтобы определить пары наигационных свойств.</p>
</div>
</div>
<div class="section" id="id6">
<h3><a class="toc-backref" href="#id21">Без свойства внешнего ключа</a><a class="headerlink" href="#id6" title="Ссылка на этот заголовок">¶</a></h3>
<p>Хотя и рекомендуется иметь свойство внешнего ключа, определенное в классе зависимой сущности, но это не обязательно. Если свойство внешнего ключа не найдено, будет введено скрытое свойство внешнего ключа с именем <code class="docutils literal"><span class="pre">&lt;имя</span> <span class="pre">навигационного</span> <span class="pre">свойства&gt;&lt;имя</span> <span class="pre">свойства</span> <span class="pre">основного</span> <span class="pre">ключа&gt;</span></code> (более подробно смотрите раздел <a class="reference internal" href="shadow-properties.html"><span class="doc">Скрытые свойства</span></a>).</p>
<div class="highlight-c#"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span></span>    <span class="k">public</span> <span class="k">class</span> <span class="nc">Blog</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="kt">int</span> <span class="n">BlogId</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">Url</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

<span class="hll">        <span class="k">public</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Post</span><span class="p">&gt;</span> <span class="n">Posts</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span>    <span class="p">}</span>

    <span class="k">public</span> <span class="k">class</span> <span class="nc">Post</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="kt">int</span> <span class="n">PostId</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">Title</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">Content</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

<span class="hll">        <span class="k">public</span> <span class="n">Blog</span> <span class="n">Blog</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span>    <span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="id7">
<h3><a class="toc-backref" href="#id22">Простое навигационное свойство</a><a class="headerlink" href="#id7" title="Ссылка на этот заголовок">¶</a></h3>
<p>Чтобы возникли отношения, определенные в соответствии с соглашением, достаточно только одного навигационного свойства (без обратной навигации, и без свойства внешнего ключа). У вас так же может быть одно свойство навигации и свойство внешнего ключа.</p>
<div class="highlight-c#"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span></span>    <span class="k">public</span> <span class="k">class</span> <span class="nc">Blog</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="kt">int</span> <span class="n">BlogId</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">Url</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

<span class="hll">        <span class="k">public</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Post</span><span class="p">&gt;</span> <span class="n">Posts</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span>    <span class="p">}</span>

    <span class="k">public</span> <span class="k">class</span> <span class="nc">Post</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="kt">int</span> <span class="n">PostId</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">Title</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">Content</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="id8">
<h3><a class="toc-backref" href="#id23">Каскадное удаление</a><a class="headerlink" href="#id8" title="Ссылка на этот заголовок">¶</a></h3>
<p>По соглашению, каскадное удаление будет установлено в <em>Cascade</em> для обязательных отношений и в <em>SetNull</em> для необязательных. <em>Cascade</em> означает, что зависимые объекты также будут удалены. <em>SetNull</em> означает, что свойства внешнего ключа в зависимых сущностях устанавливаются в null.</p>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">Такое каскадное поведение применяется только к сущностям, которые отслеживаются контекстом. Соответствующее каскадное поведение должно быть установлено в базе данных, чтобы гарантировать, что к данным, не отслеживаемым контекстом применяются те же действия. Если для создания базы данных вы используете EF, то для вас будет установлено такое каскадное поведение.</p>
</div>
</div>
</div>
<div class="section" id="id9">
<h2><a class="toc-backref" href="#id24">Аннотации данных</a><a class="headerlink" href="#id9" title="Ссылка на этот заголовок">¶</a></h2>
<p>Есть две аннотации данных, которые могут быть использованы для настройки отношений: <code class="docutils literal"><span class="pre">[ForeignKey]</span></code> и <code class="docutils literal"><span class="pre">[InverseProperty]</span></code>.</p>
<div class="section" id="foreignkey">
<h3><a class="toc-backref" href="#id25">[ForeignKey]</a><a class="headerlink" href="#foreignkey" title="Ссылка на этот заголовок">¶</a></h3>
<p>Вы можете использовать аннотацию данных для настройки свойств, которые должны использоваться как внешние ключи для данных отношений. Обычно это делается, когда свойство внешнего ключа не обнаружено по соглашению.</p>
<div class="highlight-c#"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="highlight"><pre><span></span>    <span class="k">public</span> <span class="k">class</span> <span class="nc">Blog</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="kt">int</span> <span class="n">BlogId</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">Url</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

        <span class="k">public</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Post</span><span class="p">&gt;</span> <span class="n">Posts</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">class</span> <span class="nc">Post</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="kt">int</span> <span class="n">PostId</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">Title</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">Content</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

        <span class="k">public</span> <span class="kt">int</span> <span class="n">BlogForeignKey</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

<span class="hll"><span class="na">        [ForeignKey(&quot;BlogForeignKey&quot;)]</span>
</span>        <span class="k">public</span> <span class="n">Blog</span> <span class="n">Blog</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span>
</pre></div>
</td></tr></table></div>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">Аннотация <code class="docutils literal"><span class="pre">[ForeignKey]</span></code> может быть размещена над любым навигационным свойством в отношениях. Для этого не нужно переходить на навигационные свойства в классе зависимой сущности.</p>
</div>
</div>
<div class="section" id="inverseproperty">
<h3><a class="toc-backref" href="#id26">[InverseProperty]</a><a class="headerlink" href="#inverseproperty" title="Ссылка на этот заголовок">¶</a></h3>
<p>Вы можете использовать аннотации данных для настройки того, как определяются зависимые и главные навигационные свойства для пары сущностей . Обычно это делается когда есть более чем одна пара навигационных свойствмежду двумя типами сущностей.</p>
<div class="highlight-c#"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25</pre></div></td><td class="code"><div class="highlight"><pre><span></span>    <span class="k">public</span> <span class="k">class</span> <span class="nc">Post</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="kt">int</span> <span class="n">PostId</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">Title</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">Content</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

        <span class="k">public</span> <span class="kt">int</span> <span class="n">AuthorUserId</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="n">User</span> <span class="n">Author</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

        <span class="k">public</span> <span class="kt">int</span> <span class="n">ContributorUserId</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="n">User</span> <span class="n">Contributor</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">class</span> <span class="nc">User</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">UserId</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">FirstName</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">LastName</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

<span class="hll"><span class="na">        [InverseProperty(&quot;Author&quot;)]</span>
</span>        <span class="k">public</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Post</span><span class="p">&gt;</span> <span class="n">AuthoredPosts</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

<span class="hll"><span class="na">        [InverseProperty(&quot;Contributor&quot;)]</span>
</span>        <span class="k">public</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Post</span><span class="p">&gt;</span> <span class="n">ContributedToPosts</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<div class="section" id="fluent-api">
<h2><a class="toc-backref" href="#id27">Fluent API</a><a class="headerlink" href="#fluent-api" title="Ссылка на этот заголовок">¶</a></h2>
<p>Для настройки отношений в Fluent API, вы начинаете с идентификации навигационных свойств, которые создают отношения. <code class="docutils literal"><span class="pre">HasOne</span></code> или <code class="docutils literal"><span class="pre">HasMany</span></code> идентифицируют навигационные свойства типа сущности, с которых начинается навигация. Затем вы поэтапно вызываете <code class="docutils literal"><span class="pre">WithOne</span></code> или <code class="docutils literal"><span class="pre">WithMany</span></code> чтобы идентифицировать обратную навигацию. <code class="docutils literal"><span class="pre">HasOne</span></code>/<code class="docutils literal"><span class="pre">WithOne</span></code> используется для ссылки на свойство навигации, а <code class="docutils literal"><span class="pre">HasMany</span></code>/<code class="docutils literal"><span class="pre">WithMany</span></code> используется для коллекции навигационных свойств.</p>
<div class="highlight-c#"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29</pre></div></td><td class="code"><div class="highlight"><pre><span></span>    <span class="k">class</span> <span class="nc">MyContext</span> <span class="p">:</span> <span class="n">DbContext</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="n">DbSet</span><span class="p">&lt;</span><span class="n">Blog</span><span class="p">&gt;</span> <span class="n">Blogs</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="n">DbSet</span><span class="p">&lt;</span><span class="n">Post</span><span class="p">&gt;</span> <span class="n">Posts</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

        <span class="k">protected</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">OnModelCreating</span><span class="p">(</span><span class="n">ModelBuilder</span> <span class="n">modelBuilder</span><span class="p">)</span>
        <span class="p">{</span>
<span class="hll">            <span class="n">modelBuilder</span><span class="p">.</span><span class="n">Entity</span><span class="p">&lt;</span><span class="n">Post</span><span class="p">&gt;()</span>
</span><span class="hll">                <span class="p">.</span><span class="n">HasOne</span><span class="p">(</span><span class="n">p</span> <span class="p">=&gt;</span> <span class="n">p</span><span class="p">.</span><span class="n">Blog</span><span class="p">)</span>
</span><span class="hll">                <span class="p">.</span><span class="n">WithMany</span><span class="p">(</span><span class="n">b</span> <span class="p">=&gt;</span> <span class="n">b</span><span class="p">.</span><span class="n">Posts</span><span class="p">);</span>
</span>        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">class</span> <span class="nc">Blog</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="kt">int</span> <span class="n">BlogId</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">Url</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

        <span class="k">public</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Post</span><span class="p">&gt;</span> <span class="n">Posts</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">class</span> <span class="nc">Post</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="kt">int</span> <span class="n">PostId</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">Title</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">Content</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

        <span class="k">public</span> <span class="n">Blog</span> <span class="n">Blog</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span>
</pre></div>
</td></tr></table></div>
<div class="section" id="id10">
<h3><a class="toc-backref" href="#id28">Простое навигационное свойство</a><a class="headerlink" href="#id10" title="Ссылка на этот заголовок">¶</a></h3>
<p>Если у вас есть только одно навигационное свойство, то перегрузки без параметров <code class="docutils literal"><span class="pre">WithOne</span></code> и <code class="docutils literal"><span class="pre">WithMany</span></code>. Это указывает на то, что концептуально существует ссылка или коллекция на другом конце отношений, но в классе сущностей нет свойства навигации.</p>
<div class="highlight-c#"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27</pre></div></td><td class="code"><div class="highlight"><pre><span></span>    <span class="k">class</span> <span class="nc">MyContext</span> <span class="p">:</span> <span class="n">DbContext</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="n">DbSet</span><span class="p">&lt;</span><span class="n">Blog</span><span class="p">&gt;</span> <span class="n">Blogs</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="n">DbSet</span><span class="p">&lt;</span><span class="n">Post</span><span class="p">&gt;</span> <span class="n">Posts</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

        <span class="k">protected</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">OnModelCreating</span><span class="p">(</span><span class="n">ModelBuilder</span> <span class="n">modelBuilder</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">modelBuilder</span><span class="p">.</span><span class="n">Entity</span><span class="p">&lt;</span><span class="n">Blog</span><span class="p">&gt;()</span>
                <span class="p">.</span><span class="n">HasMany</span><span class="p">(</span><span class="n">b</span> <span class="p">=&gt;</span> <span class="n">b</span><span class="p">.</span><span class="n">Posts</span><span class="p">)</span>
<span class="hll">                <span class="p">.</span><span class="n">WithOne</span><span class="p">();</span>
</span>        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">class</span> <span class="nc">Blog</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="kt">int</span> <span class="n">BlogId</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">Url</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

        <span class="k">public</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Post</span><span class="p">&gt;</span> <span class="n">Posts</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">class</span> <span class="nc">Post</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="kt">int</span> <span class="n">PostId</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">Title</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">Content</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="id11">
<h3><a class="toc-backref" href="#id29">Внешний ключ</a><a class="headerlink" href="#id11" title="Ссылка на этот заголовок">¶</a></h3>
<p>Вы можете использовать Fluent API для настройки свойств, которые должны использоваться как внешние ключи для данных отношений.</p>
<div class="highlight-c#"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31</pre></div></td><td class="code"><div class="highlight"><pre><span></span>    <span class="k">class</span> <span class="nc">MyContext</span> <span class="p">:</span> <span class="n">DbContext</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="n">DbSet</span><span class="p">&lt;</span><span class="n">Blog</span><span class="p">&gt;</span> <span class="n">Blogs</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="n">DbSet</span><span class="p">&lt;</span><span class="n">Post</span><span class="p">&gt;</span> <span class="n">Posts</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

        <span class="k">protected</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">OnModelCreating</span><span class="p">(</span><span class="n">ModelBuilder</span> <span class="n">modelBuilder</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">modelBuilder</span><span class="p">.</span><span class="n">Entity</span><span class="p">&lt;</span><span class="n">Post</span><span class="p">&gt;()</span>
                <span class="p">.</span><span class="n">HasOne</span><span class="p">(</span><span class="n">p</span> <span class="p">=&gt;</span> <span class="n">p</span><span class="p">.</span><span class="n">Blog</span><span class="p">)</span>
                <span class="p">.</span><span class="n">WithMany</span><span class="p">(</span><span class="n">b</span> <span class="p">=&gt;</span> <span class="n">b</span><span class="p">.</span><span class="n">Posts</span><span class="p">)</span>
<span class="hll">                <span class="p">.</span><span class="n">HasForeignKey</span><span class="p">(</span><span class="n">p</span> <span class="p">=&gt;</span> <span class="n">p</span><span class="p">.</span><span class="n">BlogForeignKey</span><span class="p">);</span>
</span>        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">class</span> <span class="nc">Blog</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="kt">int</span> <span class="n">BlogId</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">Url</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

        <span class="k">public</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Post</span><span class="p">&gt;</span> <span class="n">Posts</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">class</span> <span class="nc">Post</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="kt">int</span> <span class="n">PostId</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">Title</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">Content</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

        <span class="k">public</span> <span class="kt">int</span> <span class="n">BlogForeignKey</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="n">Blog</span> <span class="n">Blog</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>Следующий код показывает, как настроить составной внешний ключ.</p>
<div class="highlight-c#"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36</pre></div></td><td class="code"><div class="highlight"><pre><span></span>    <span class="k">class</span> <span class="nc">MyContext</span> <span class="p">:</span> <span class="n">DbContext</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="n">DbSet</span><span class="p">&lt;</span><span class="n">Car</span><span class="p">&gt;</span> <span class="n">Cars</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

        <span class="k">protected</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">OnModelCreating</span><span class="p">(</span><span class="n">ModelBuilder</span> <span class="n">modelBuilder</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">modelBuilder</span><span class="p">.</span><span class="n">Entity</span><span class="p">&lt;</span><span class="n">Car</span><span class="p">&gt;()</span>
                <span class="p">.</span><span class="n">HasKey</span><span class="p">(</span><span class="n">c</span> <span class="p">=&gt;</span> <span class="k">new</span> <span class="p">{</span> <span class="n">c</span><span class="p">.</span><span class="n">State</span><span class="p">,</span> <span class="n">c</span><span class="p">.</span><span class="n">LicensePlate</span> <span class="p">});</span>

            <span class="n">modelBuilder</span><span class="p">.</span><span class="n">Entity</span><span class="p">&lt;</span><span class="n">RecordOfSale</span><span class="p">&gt;()</span>
                <span class="p">.</span><span class="n">HasOne</span><span class="p">(</span><span class="n">s</span> <span class="p">=&gt;</span> <span class="n">s</span><span class="p">.</span><span class="n">Car</span><span class="p">)</span>
                <span class="p">.</span><span class="n">WithMany</span><span class="p">(</span><span class="n">c</span> <span class="p">=&gt;</span> <span class="n">c</span><span class="p">.</span><span class="n">SaleHistory</span><span class="p">)</span>
<span class="hll">                <span class="p">.</span><span class="n">HasForeignKey</span><span class="p">(</span><span class="n">s</span> <span class="p">=&gt;</span> <span class="k">new</span> <span class="p">{</span> <span class="n">s</span><span class="p">.</span><span class="n">CarState</span><span class="p">,</span> <span class="n">s</span><span class="p">.</span><span class="n">CarLicensePlate</span> <span class="p">});</span>
</span>        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">class</span> <span class="nc">Car</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">State</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">LicensePlate</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">Make</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">Model</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

        <span class="k">public</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">RecordOfSale</span><span class="p">&gt;</span> <span class="n">SaleHistory</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">class</span> <span class="nc">RecordOfSale</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="kt">int</span> <span class="n">RecordOfSaleId</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="n">DateTime</span> <span class="n">DateSold</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">decimal</span> <span class="n">Price</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

        <span class="k">public</span> <span class="kt">string</span> <span class="n">CarState</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">CarLicensePlate</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="n">Car</span> <span class="n">Car</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="id12">
<h3><a class="toc-backref" href="#id30">Главный ключ</a><a class="headerlink" href="#id12" title="Ссылка на этот заголовок">¶</a></h3>
<p>Если для отношения требуется внешний ключ для ссылки на свойство отличающийся от первичного ключа, можно использовать Fluent API для настройки свойства Principal Key. Свойство, которое вы сконфигурируете как главный ключ будет автоматически установлено как альтернативный ключ (более подробно смотрите <a class="reference internal" href="alternate-keys.html"><span class="doc">Альтернативные ключи</span></a>).</p>
<div class="highlight-c#"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33</pre></div></td><td class="code"><div class="highlight"><pre><span></span>    <span class="k">class</span> <span class="nc">MyContext</span> <span class="p">:</span> <span class="n">DbContext</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="n">DbSet</span><span class="p">&lt;</span><span class="n">Car</span><span class="p">&gt;</span> <span class="n">Cars</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

        <span class="k">protected</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">OnModelCreating</span><span class="p">(</span><span class="n">ModelBuilder</span> <span class="n">modelBuilder</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">modelBuilder</span><span class="p">.</span><span class="n">Entity</span><span class="p">&lt;</span><span class="n">RecordOfSale</span><span class="p">&gt;()</span>
                <span class="p">.</span><span class="n">HasOne</span><span class="p">(</span><span class="n">s</span> <span class="p">=&gt;</span> <span class="n">s</span><span class="p">.</span><span class="n">Car</span><span class="p">)</span>
                <span class="p">.</span><span class="n">WithMany</span><span class="p">(</span><span class="n">c</span> <span class="p">=&gt;</span> <span class="n">c</span><span class="p">.</span><span class="n">SaleHistory</span><span class="p">)</span>
                <span class="p">.</span><span class="n">HasForeignKey</span><span class="p">(</span><span class="n">s</span> <span class="p">=&gt;</span> <span class="n">s</span><span class="p">.</span><span class="n">CarLicensePlate</span><span class="p">)</span>
<span class="hll">                <span class="p">.</span><span class="n">HasPrincipalKey</span><span class="p">(</span><span class="n">c</span> <span class="p">=&gt;</span> <span class="n">c</span><span class="p">.</span><span class="n">LicensePlate</span><span class="p">);</span>
</span>        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">class</span> <span class="nc">Car</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="kt">int</span> <span class="n">CarId</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">LicensePlate</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">Make</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">Model</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

        <span class="k">public</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">RecordOfSale</span><span class="p">&gt;</span> <span class="n">SaleHistory</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">class</span> <span class="nc">RecordOfSale</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="kt">int</span> <span class="n">RecordOfSaleId</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="n">DateTime</span> <span class="n">DateSold</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">decimal</span> <span class="n">Price</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

        <span class="k">public</span> <span class="kt">string</span> <span class="n">CarLicensePlate</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="n">Car</span> <span class="n">Car</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>Следующий код показывает, как настроить составной главный ключ.</p>
<div class="highlight-c#"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35</pre></div></td><td class="code"><div class="highlight"><pre><span></span>    <span class="k">class</span> <span class="nc">MyContext</span> <span class="p">:</span> <span class="n">DbContext</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="n">DbSet</span><span class="p">&lt;</span><span class="n">Car</span><span class="p">&gt;</span> <span class="n">Cars</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

        <span class="k">protected</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">OnModelCreating</span><span class="p">(</span><span class="n">ModelBuilder</span> <span class="n">modelBuilder</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">modelBuilder</span><span class="p">.</span><span class="n">Entity</span><span class="p">&lt;</span><span class="n">RecordOfSale</span><span class="p">&gt;()</span>
                <span class="p">.</span><span class="n">HasOne</span><span class="p">(</span><span class="n">s</span> <span class="p">=&gt;</span> <span class="n">s</span><span class="p">.</span><span class="n">Car</span><span class="p">)</span>
                <span class="p">.</span><span class="n">WithMany</span><span class="p">(</span><span class="n">c</span> <span class="p">=&gt;</span> <span class="n">c</span><span class="p">.</span><span class="n">SaleHistory</span><span class="p">)</span>
                <span class="p">.</span><span class="n">HasForeignKey</span><span class="p">(</span><span class="n">s</span> <span class="p">=&gt;</span> <span class="k">new</span> <span class="p">{</span> <span class="n">s</span><span class="p">.</span><span class="n">CarState</span><span class="p">,</span> <span class="n">s</span><span class="p">.</span><span class="n">CarLicensePlate</span> <span class="p">})</span>
<span class="hll">                <span class="p">.</span><span class="n">HasPrincipalKey</span><span class="p">(</span><span class="n">c</span> <span class="p">=&gt;</span> <span class="k">new</span> <span class="p">{</span> <span class="n">c</span><span class="p">.</span><span class="n">State</span><span class="p">,</span> <span class="n">c</span><span class="p">.</span><span class="n">LicensePlate</span> <span class="p">});</span>
</span>        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">class</span> <span class="nc">Car</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="kt">int</span> <span class="n">CarId</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">State</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">LicensePlate</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">Make</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">Model</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

        <span class="k">public</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">RecordOfSale</span><span class="p">&gt;</span> <span class="n">SaleHistory</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">class</span> <span class="nc">RecordOfSale</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="kt">int</span> <span class="n">RecordOfSaleId</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="n">DateTime</span> <span class="n">DateSold</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">decimal</span> <span class="n">Price</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

        <span class="k">public</span> <span class="kt">string</span> <span class="n">CarState</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">CarLicensePlate</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="n">Car</span> <span class="n">Car</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span>
</pre></div>
</td></tr></table></div>
<div class="admonition attention">
<p class="first admonition-title">Внимание</p>
<p class="last">Порядок, в котором вы определили свойства главного ключа должен соответствовать порядку в котором указаны внешние ключи.</p>
</div>
</div>
<div class="section" id="required">
<h3><a class="toc-backref" href="#id31">Required</a><a class="headerlink" href="#required" title="Ссылка на этот заголовок">¶</a></h3>
<p>Вы можете использовать Fluent API для настройки как обязательных отношений, так и необязательных. В конечном итоге это управляет тем, является ли свойство внешнего ключа обязательным или необязательным. Это особенно полезно, когда вы используете скрытое состояние внешнего ключа. Если у вас в классе сущностей есть свойство внешнего ключа, то необходимость отношения определяется на основе того, является ли свойство внешнего ключа обязательным или необязательным (для получения дополнительной информации смотрите <a class="reference internal" href="required-optional.html"><span class="doc">Обязательные/необязательные свойства</span></a>).</p>
<div class="highlight-c#"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30</pre></div></td><td class="code"><div class="highlight"><pre><span></span>    <span class="k">class</span> <span class="nc">MyContext</span> <span class="p">:</span> <span class="n">DbContext</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="n">DbSet</span><span class="p">&lt;</span><span class="n">Blog</span><span class="p">&gt;</span> <span class="n">Blogs</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="n">DbSet</span><span class="p">&lt;</span><span class="n">Post</span><span class="p">&gt;</span> <span class="n">Posts</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

        <span class="k">protected</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">OnModelCreating</span><span class="p">(</span><span class="n">ModelBuilder</span> <span class="n">modelBuilder</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">modelBuilder</span><span class="p">.</span><span class="n">Entity</span><span class="p">&lt;</span><span class="n">Post</span><span class="p">&gt;()</span>
                <span class="p">.</span><span class="n">HasOne</span><span class="p">(</span><span class="n">p</span> <span class="p">=&gt;</span> <span class="n">p</span><span class="p">.</span><span class="n">Blog</span><span class="p">)</span>
                <span class="p">.</span><span class="n">WithMany</span><span class="p">(</span><span class="n">b</span> <span class="p">=&gt;</span> <span class="n">b</span><span class="p">.</span><span class="n">Posts</span><span class="p">)</span>
<span class="hll">                <span class="p">.</span><span class="n">IsRequired</span><span class="p">();</span>
</span>        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">class</span> <span class="nc">Blog</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="kt">int</span> <span class="n">BlogId</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">Url</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

        <span class="k">public</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Post</span><span class="p">&gt;</span> <span class="n">Posts</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">class</span> <span class="nc">Post</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="kt">int</span> <span class="n">PostId</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">Title</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">Content</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

        <span class="k">public</span> <span class="n">Blog</span> <span class="n">Blog</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="id13">
<h3><a class="toc-backref" href="#id32">Каскадное удаление</a><a class="headerlink" href="#id13" title="Ссылка на этот заголовок">¶</a></h3>
<p>Вы можете использовать Fluent API для настройки поведения каскадного удаления для данных отношений.</p>
<dl class="docutils">
<dt>Есть три модели поведения, которые управляют тем, как применяется операция удаления зависимых сущностей в оношениях, когда главный удаляется или разорвал отношения.</dt>
<dd><ul class="first last simple">
<li><strong>Cascade:</strong> Зависимые сущности также будут удалены.</li>
<li><strong>SetNull:</strong> Свойства внешнего ключа в зависимых сущностях устанавливаются в значение null.</li>
<li><strong>Restrict:</strong> Операция удаления не применяется к зависимой сущности. Зависимые сущности остаются неизменными.</li>
</ul>
</dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">Такое каскадное поведение применяется только к сущностям, которые отслеживаются контекстом. Соответствующее каскадное поведение должно быть установлено в базе данных, чтобы гарантировать, что к данным, не отслеживаемым контекстом применяются те же действия. Если для создания базы данных вы используете EF, то для вас будет установлено такое каскадное поведение.</p>
</div>
<div class="highlight-c#"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31</pre></div></td><td class="code"><div class="highlight"><pre><span></span>    <span class="k">class</span> <span class="nc">MyContext</span> <span class="p">:</span> <span class="n">DbContext</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="n">DbSet</span><span class="p">&lt;</span><span class="n">Blog</span><span class="p">&gt;</span> <span class="n">Blogs</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="n">DbSet</span><span class="p">&lt;</span><span class="n">Post</span><span class="p">&gt;</span> <span class="n">Posts</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

        <span class="k">protected</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">OnModelCreating</span><span class="p">(</span><span class="n">ModelBuilder</span> <span class="n">modelBuilder</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">modelBuilder</span><span class="p">.</span><span class="n">Entity</span><span class="p">&lt;</span><span class="n">Post</span><span class="p">&gt;()</span>
                <span class="p">.</span><span class="n">HasOne</span><span class="p">(</span><span class="n">p</span> <span class="p">=&gt;</span> <span class="n">p</span><span class="p">.</span><span class="n">Blog</span><span class="p">)</span>
                <span class="p">.</span><span class="n">WithMany</span><span class="p">(</span><span class="n">b</span> <span class="p">=&gt;</span> <span class="n">b</span><span class="p">.</span><span class="n">Posts</span><span class="p">)</span>
<span class="hll">                <span class="p">.</span><span class="n">OnDelete</span><span class="p">(</span><span class="n">DeleteBehavior</span><span class="p">.</span><span class="n">Cascade</span><span class="p">);</span>
</span>        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">class</span> <span class="nc">Blog</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="kt">int</span> <span class="n">BlogId</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">Url</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

        <span class="k">public</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Post</span><span class="p">&gt;</span> <span class="n">Posts</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">class</span> <span class="nc">Post</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="kt">int</span> <span class="n">PostId</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">Title</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">Content</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

        <span class="k">public</span> <span class="kt">int?</span> <span class="n">BlogId</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="n">Blog</span> <span class="n">Blog</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<div class="section" id="id14">
<h2><a class="toc-backref" href="#id33">Другие модели отношений</a><a class="headerlink" href="#id14" title="Ссылка на этот заголовок">¶</a></h2>
<div class="section" id="id15">
<h3><a class="toc-backref" href="#id34">Один-к-одному</a><a class="headerlink" href="#id15" title="Ссылка на этот заголовок">¶</a></h3>
<p>Отношения один-к-одному имеют ссылочные навигационные свойства на обеих сторонах. Они соблюдают те же соглашения, что и один-ко-многим, но в свойство внешнего ключа вводится уникальный индекс чтобы убедиться, что одному зависящей сущности соответствует только одна главная.</p>
<div class="highlight-c#"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="highlight"><pre><span></span>    <span class="k">public</span> <span class="k">class</span> <span class="nc">Blog</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="kt">int</span> <span class="n">BlogId</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">Url</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

<span class="hll">        <span class="k">public</span> <span class="n">BlogImage</span> <span class="n">BlogImage</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span>    <span class="p">}</span>

    <span class="k">public</span> <span class="k">class</span> <span class="nc">BlogImage</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="kt">int</span> <span class="n">BlogImageId</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">byte</span><span class="p">[]</span> <span class="n">Image</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">Caption</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

<span class="hll">        <span class="k">public</span> <span class="kt">int</span> <span class="n">BlogId</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class="hll">        <span class="k">public</span> <span class="n">Blog</span> <span class="n">Blog</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span>    <span class="p">}</span>
</pre></div>
</td></tr></table></div>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">EF будет выбрать в качестве зависимого одного из субъектов, основываясь на своей способности обнаруживать свойство внешнего ключа. Если в качестве зависимого выбрана неправильная сущность, можно использовать Fluent API чтобы исправить это.</p>
</div>
<p>При настройке отношения при помощи Fluent API, вы используете методы <code class="docutils literal"><span class="pre">HasOne</span></code> и <code class="docutils literal"><span class="pre">WithOne</span></code> .</p>
<p>Когда конфигурируется внешний ключ, вам необходимо определить тип зависимой сущности - обратите внимание на общий параметр представляющий <code class="docutils literal"><span class="pre">HasForeignKey</span></code> в листинге ниже. В отношениях один-ко-многим понятно, что сущность с навигационной ссылкой является зависимой, а другая с соллекцией это главная. Но это не так в отношении один к одному - следовательно, необходимо явным образом определить его.</p>
<div class="highlight-c#"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31</pre></div></td><td class="code"><div class="highlight"><pre><span></span>    <span class="k">class</span> <span class="nc">MyContext</span> <span class="p">:</span> <span class="n">DbContext</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="n">DbSet</span><span class="p">&lt;</span><span class="n">Blog</span><span class="p">&gt;</span> <span class="n">Blogs</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="n">DbSet</span><span class="p">&lt;</span><span class="n">BlogImage</span><span class="p">&gt;</span> <span class="n">BlogImages</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

        <span class="k">protected</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">OnModelCreating</span><span class="p">(</span><span class="n">ModelBuilder</span> <span class="n">modelBuilder</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">modelBuilder</span><span class="p">.</span><span class="n">Entity</span><span class="p">&lt;</span><span class="n">Blog</span><span class="p">&gt;()</span>
                <span class="p">.</span><span class="n">HasOne</span><span class="p">(</span><span class="n">p</span> <span class="p">=&gt;</span> <span class="n">p</span><span class="p">.</span><span class="n">BlogImage</span><span class="p">)</span>
                <span class="p">.</span><span class="n">WithOne</span><span class="p">(</span><span class="n">i</span> <span class="p">=&gt;</span> <span class="n">i</span><span class="p">.</span><span class="n">Blog</span><span class="p">)</span>
<span class="hll">                <span class="p">.</span><span class="n">HasForeignKey</span><span class="p">&lt;</span><span class="n">BlogImage</span><span class="p">&gt;(</span><span class="n">b</span> <span class="p">=&gt;</span> <span class="n">b</span><span class="p">.</span><span class="n">BlogForeignKey</span><span class="p">);</span>
</span>        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">class</span> <span class="nc">Blog</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="kt">int</span> <span class="n">BlogId</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">Url</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

        <span class="k">public</span> <span class="n">BlogImage</span> <span class="n">BlogImage</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">class</span> <span class="nc">BlogImage</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="kt">int</span> <span class="n">BlogImageId</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">byte</span><span class="p">[]</span> <span class="n">Image</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">Caption</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

        <span class="k">public</span> <span class="kt">int</span> <span class="n">BlogForeignKey</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="n">Blog</span> <span class="n">Blog</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="id16">
<h3><a class="toc-backref" href="#id35">Многие-ко-многим</a><a class="headerlink" href="#id16" title="Ссылка на этот заголовок">¶</a></h3>
<p>Отношения многие-ко-многим без класса сущности для представления таблицы вхождений пока не поддерживаются. Однако, вы можете представить отношения многие-ко-многим включив класс сущности в таблицу вхождений и отобразить два отдельных отношения один-ко-многим.</p>
<div class="highlight-c#"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46</pre></div></td><td class="code"><div class="highlight"><pre><span></span>    <span class="k">class</span> <span class="nc">MyContext</span> <span class="p">:</span> <span class="n">DbContext</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="n">DbSet</span><span class="p">&lt;</span><span class="n">Post</span><span class="p">&gt;</span> <span class="n">Posts</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="n">DbSet</span><span class="p">&lt;</span><span class="n">Tag</span><span class="p">&gt;</span> <span class="n">Tags</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

        <span class="k">protected</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">OnModelCreating</span><span class="p">(</span><span class="n">ModelBuilder</span> <span class="n">modelBuilder</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">modelBuilder</span><span class="p">.</span><span class="n">Entity</span><span class="p">&lt;</span><span class="n">PostTag</span><span class="p">&gt;()</span>
                <span class="p">.</span><span class="n">HasKey</span><span class="p">(</span><span class="n">t</span> <span class="p">=&gt;</span> <span class="k">new</span> <span class="p">{</span> <span class="n">t</span><span class="p">.</span><span class="n">PostId</span><span class="p">,</span> <span class="n">t</span><span class="p">.</span><span class="n">TagId</span> <span class="p">});</span>

<span class="hll">            <span class="n">modelBuilder</span><span class="p">.</span><span class="n">Entity</span><span class="p">&lt;</span><span class="n">PostTag</span><span class="p">&gt;()</span>
</span><span class="hll">                <span class="p">.</span><span class="n">HasOne</span><span class="p">(</span><span class="n">pt</span> <span class="p">=&gt;</span> <span class="n">pt</span><span class="p">.</span><span class="n">Post</span><span class="p">)</span>
</span><span class="hll">                <span class="p">.</span><span class="n">WithMany</span><span class="p">(</span><span class="n">p</span> <span class="p">=&gt;</span> <span class="n">p</span><span class="p">.</span><span class="n">PostTags</span><span class="p">)</span>
</span><span class="hll">                <span class="p">.</span><span class="n">HasForeignKey</span><span class="p">(</span><span class="n">pt</span> <span class="p">=&gt;</span> <span class="n">pt</span><span class="p">.</span><span class="n">PostId</span><span class="p">);</span>
</span>
<span class="hll">            <span class="n">modelBuilder</span><span class="p">.</span><span class="n">Entity</span><span class="p">&lt;</span><span class="n">PostTag</span><span class="p">&gt;()</span>
</span><span class="hll">                <span class="p">.</span><span class="n">HasOne</span><span class="p">(</span><span class="n">pt</span> <span class="p">=&gt;</span> <span class="n">pt</span><span class="p">.</span><span class="n">Tag</span><span class="p">)</span>
</span><span class="hll">                <span class="p">.</span><span class="n">WithMany</span><span class="p">(</span><span class="n">t</span> <span class="p">=&gt;</span> <span class="n">t</span><span class="p">.</span><span class="n">PostTags</span><span class="p">)</span>
</span><span class="hll">                <span class="p">.</span><span class="n">HasForeignKey</span><span class="p">(</span><span class="n">pt</span> <span class="p">=&gt;</span> <span class="n">pt</span><span class="p">.</span><span class="n">TagId</span><span class="p">);</span>
</span>        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">class</span> <span class="nc">Post</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="kt">int</span> <span class="n">PostId</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">Title</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">Content</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

        <span class="k">public</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">PostTag</span><span class="p">&gt;</span> <span class="n">PostTags</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">class</span> <span class="nc">Tag</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">TagId</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

        <span class="k">public</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">PostTag</span><span class="p">&gt;</span> <span class="n">PostTags</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span>

<span class="hll">    <span class="k">public</span> <span class="k">class</span> <span class="nc">PostTag</span>
</span><span class="hll">    <span class="p">{</span>
</span><span class="hll">        <span class="k">public</span> <span class="kt">int</span> <span class="n">PostId</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class="hll">        <span class="k">public</span> <span class="n">Post</span> <span class="n">Post</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class="hll">
</span><span class="hll">        <span class="k">public</span> <span class="kt">string</span> <span class="n">TagId</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class="hll">        <span class="k">public</span> <span class="n">Tag</span> <span class="n">Tag</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class="hll">    <span class="p">}</span>
</span></pre></div>
</td></tr></table></div>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="indexes.html" class="btn btn-neutral float-right" title="Индексы" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="shadow-properties.html" class="btn btn-neutral" title="Скрытые свойства" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016 Microsoft.
      Обновлено: июл. 18, 2016.

    </p>
  </div> Документация лицензирована под <a href="https://creativecommons.org/licenses/by-nc/3.0/">CC BY-NC 3.0</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.0.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="../_static/wedc.js"></script>
      <script type="text/javascript" src="../_static/translations.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>