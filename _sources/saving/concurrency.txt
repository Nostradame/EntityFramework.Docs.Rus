Конфликты параллелизма
======================

Если свойство отмечено как маркер параллелизма, то EF будет проверять, что другие пользователи не будут изменять это значение в базе данных в момент сохранения измененной записи.

.. contents:: `В этой статье:`
    :depth: 2
    :local:

.. include:: /_shared/sample.txt
.. _пример: https://github.com/aspnet/EntityFramework.Docs/tree/master/samples/Saving/Saving/Concurrency/

Как параллелизм работает в EF
-----------------------------

Подробное описание работы параллелизма в Entity Framework смотрите в разделе :doc:`/modeling/concurrency`.

Решение конфликтов параллелизма
-------------------------------

Решение конфликтов параллелизма включает в себя использование алгоритма для слияния ожидающих изменений от имени текущего пользователя с изменениями, сделанными в базе данных. Точный подход будет меняться в зависимости от приложения, но общий подход это показывать значения пользователю, а их решенные правильные значения должны сохраняться в базе данных.

Есть три набора значений, которые помогают решить конфликт параллелизма.
 * **Текущие значения** это значения, которые приложение пытается записать в базу данных.
 * **Оригинальные значения** это значения, которые первоначально были извлечены из базы данных, прежде чем были сделаны какие-либо изменения.
 * **Значения базы данных** это значения, которые в настоящее время хранятся в базе данных.

Для обработки конфликтов параллелизма, необходимо во время ``SaveChanges()`` поймать ``DbUpdateConcurrencyException``, для подготовки нового набора изменений для поврежденных сущностей используйте ``DbUpdateConcurrencyException.Entries``, а затем попробуйте снова выполнить операцию ``SaveChanges()``.

В следующем примере ``Person.FirstName`` и ``Person.LastName`` установлены как маркеры параллелизма. В том месте, где вы должны вставить логику приложения для определения правильного значения, которое будет записано в базу данных стоит комментарий ``// TODO:``.

.. includesamplefile:: Saving/Saving/Concurrency/Sample.cs
        :language: c#
        :emphasize-lines: 53-54
        :linenos:
