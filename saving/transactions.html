

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Transactions &mdash; –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Entity Framework Core 1.0.0</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  

  
    <link rel="top" title="–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Entity Framework Core 1.0.0" href="../index.html"/>
        <link rel="up" title="–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö" href="index.html"/>
        <link rel="next" title="üîß –ù–µ—Å–≤—è–∑–∞–Ω–Ω—ã–µ –°—É—â–Ω–æ—Å—Ç–∏" href="disconnected-entities.html"/>
        <link rel="prev" title="Concurrency Conflicts" href="concurrency.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Entity Framework Core
          

          
          </a>

          
            
            
              <div class="version">
                1.0.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../intro.html">Entity Framework Core</a></li>
<li class="toctree-l1"><a class="reference internal" href="../platforms/index.html">–ü—Ä–∏—Å—Ç—É–ø–∞—è –∫ —Ä–∞–±–æ—Ç–µ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modeling/index.html">–°–æ–∑–¥–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏</a></li>
<li class="toctree-l1"><a class="reference internal" href="../querying/index.html">–ó–∞–ø—Ä–æ—Å –¥–∞–Ω–Ω—ã—Ö</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="basic.html">–û—Å–Ω–æ–≤—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è</a></li>
<li class="toctree-l2"><a class="reference internal" href="related-data.html">–°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</a></li>
<li class="toctree-l2"><a class="reference internal" href="cascade-delete.html">–ö–∞—Å–∫–∞–¥–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ</a></li>
<li class="toctree-l2"><a class="reference internal" href="concurrency.html">Concurrency Conflicts</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Transactions</a><ul class="simple">
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="disconnected-entities.html">üîß –ù–µ—Å–≤—è–∑–∞–Ω–Ω—ã–µ –°—É—â–Ω–æ—Å—Ç–∏</a></li>
<li class="toctree-l2"><a class="reference internal" href="explicit-values-generated-properties.html">–£—Å—Ç–∞–Ω–æ–≤–∫–∞ —è–≤–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π –¥–ª—è –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º—ã—Ö —Å–≤–æ–π—Å—Ç–≤</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../efcore-vs-ef6/index.html">EF Core vs. EF6.x</a></li>
<li class="toctree-l1"><a class="reference internal" href="../providers/index.html">–ü—Ä–æ–≤–∞–π–¥–µ—Ä—ã –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö</a></li>
<li class="toctree-l1"><a class="reference internal" href="../miscellaneous/index.html">–†–∞–∑–Ω–æ–µ</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">Entity Framework Core</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="index.html">–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö</a> &raquo;</li>
      
    <li>Transactions</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="admonition attention">
<p class="first admonition-title">–í–Ω–∏–º–∞–Ω–∏–µ</p>
<p class="last">–≠—Ç–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–ª—è EF Core. –î–ª—è EF6.x –∏ –±–æ–ª–µ–µ —Ä–∞–Ω–Ω–∏—Ö –≤–µ—Ä—Å–∏–π —Å–º–æ—Ç—Ä–∏—Ç–µ <a class="reference external" href="http://msdn.com/data/ef">http://msdn.com/data/ef</a>.</p>
</div>
<div class="section" id="transactions">
<h1>Transactions<a class="headerlink" href="#transactions" title="–°—Å—ã–ª–∫–∞ –Ω–∞ —ç—Ç–æ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫">¬∂</a></h1>
<p>Transactions allow several database operations to be processed in an atomic manner. If the transaction is committed, all of the operations are successfully applied to the database. If the transaction is rolled back, none of the operations are applied to the database.</p>
<div class="contents local topic" id="id1">
<p class="topic-title first"><cite>–í —ç—Ç–æ–π —Å—Ç–∞—Ç—å–µ:</cite></p>
<ul class="simple">
<li><a class="reference internal" href="#default-transaction-behavior" id="id3">Default transaction behavior</a></li>
<li><a class="reference internal" href="#controlling-transactions" id="id4">Controlling transactions</a></li>
<li><a class="reference internal" href="#cross-context-transaction-relational-databases-only" id="id5">Cross-context transaction (relational databases only)</a><ul>
<li><a class="reference internal" href="#allow-connection-to-be-externally-provided" id="id6">Allow connection to be externally provided</a></li>
<li><a class="reference internal" href="#share-connection-and-transaction" id="id7">Share connection and transaction</a></li>
</ul>
</li>
<li><a class="reference internal" href="#using-external-dbtransactions-relational-databases-only" id="id8">Using external DbTransactions (relational databases only)</a></li>
</ul>
</div>
<div class="admonition tip">
<p class="first admonition-title">–°–æ–≤–µ—Ç</p>
<p class="last">–í—ã –º–æ–∂–µ—Ç–µ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å <a class="reference external" href="https://github.com/aspnet/EntityFramework.Docs/tree/master/samples/Saving/Saving/Transactions/">–ø—Ä–∏–º–µ—Ä</a> —ç—Ç–æ–π —Å—Ç–∞—Ç—å–∏ –Ω–∞ GitHub.</p>
</div>
<div class="section" id="default-transaction-behavior">
<h2><a class="toc-backref" href="#id3">Default transaction behavior</a><a class="headerlink" href="#default-transaction-behavior" title="–°—Å—ã–ª–∫–∞ –Ω–∞ —ç—Ç–æ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫">¬∂</a></h2>
<p>By default, if the database provider supports transactions, all changes in a single call to <code class="docutils literal"><span class="pre">SaveChanges()</span></code> are applied in a transaction. If any of the changes fail, then the transaction is rolled back and none of the changes are applied to the database. This means that <code class="docutils literal"><span class="pre">SaveChanges()</span></code> is guaranteed to either completely succeed, or leave the database unmodified if an error occurs.</p>
<p>For most applications, this default behavior is sufficient. You should only manually control transactions if your application requirements deem it necessary.</p>
</div>
<div class="section" id="controlling-transactions">
<h2><a class="toc-backref" href="#id4">Controlling transactions</a><a class="headerlink" href="#controlling-transactions" title="–°—Å—ã–ª–∫–∞ –Ω–∞ —ç—Ç–æ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫">¬∂</a></h2>
<p>You can use the <code class="docutils literal"><span class="pre">DbContext.Database</span></code> API to begin, commit, and rollback transactions. The following example shows two <code class="docutils literal"><span class="pre">SaveChanges()</span></code> operations and a LINQ query being executed in a single transaction.</p>
<p>Not all database providers support transactions. Some providers may throw or no-op when transaction APIs are called.</p>
<div class="highlight-c#"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26</pre></div></td><td class="code"><div class="highlight"><pre><span></span>            <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">context</span> <span class="p">=</span> <span class="k">new</span> <span class="n">BloggingContext</span><span class="p">())</span>
            <span class="p">{</span>
<span class="hll">                <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">transaction</span> <span class="p">=</span> <span class="n">context</span><span class="p">.</span><span class="n">Database</span><span class="p">.</span><span class="n">BeginTransaction</span><span class="p">())</span>
</span>                <span class="p">{</span>
                    <span class="k">try</span>
                    <span class="p">{</span>
                        <span class="n">context</span><span class="p">.</span><span class="n">Blogs</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="k">new</span> <span class="n">Blog</span> <span class="p">{</span> <span class="n">Url</span> <span class="p">=</span> <span class="s">&quot;http://blogs.msdn.com/dotnet&quot;</span> <span class="p">});</span>
                        <span class="n">context</span><span class="p">.</span><span class="n">SaveChanges</span><span class="p">();</span>

                        <span class="n">context</span><span class="p">.</span><span class="n">Blogs</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="k">new</span> <span class="n">Blog</span> <span class="p">{</span> <span class="n">Url</span> <span class="p">=</span> <span class="s">&quot;http://blogs.msdn.com/visualstudio&quot;</span> <span class="p">});</span>
                        <span class="n">context</span><span class="p">.</span><span class="n">SaveChanges</span><span class="p">();</span>

                        <span class="kt">var</span> <span class="n">blogs</span> <span class="p">=</span> <span class="n">context</span><span class="p">.</span><span class="n">Blogs</span>
                            <span class="p">.</span><span class="n">OrderBy</span><span class="p">(</span><span class="n">b</span> <span class="p">=&gt;</span> <span class="n">b</span><span class="p">.</span><span class="n">Url</span><span class="p">)</span>
                            <span class="p">.</span><span class="n">ToList</span><span class="p">();</span>

<span class="hll">                        <span class="c1">// Commit transaction if all commands succeed, transaction will auto-rollback</span>
</span><span class="hll">                        <span class="c1">// when disposed if either commands fails</span>
</span><span class="hll">                        <span class="n">transaction</span><span class="p">.</span><span class="n">Commit</span><span class="p">();</span>
</span>                    <span class="p">}</span>
                    <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="c1">// TODO: Handle failure</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="cross-context-transaction-relational-databases-only">
<h2><a class="toc-backref" href="#id5">Cross-context transaction (relational databases only)</a><a class="headerlink" href="#cross-context-transaction-relational-databases-only" title="–°—Å—ã–ª–∫–∞ –Ω–∞ —ç—Ç–æ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫">¬∂</a></h2>
<p>You can also share a transaction across multiple context instances. This functionality is only available when using a relational database provider because it requires the use of <code class="docutils literal"><span class="pre">DbTransaction</span></code> and <code class="docutils literal"><span class="pre">DbConnection</span></code>, which are specific to relational databases.</p>
<p>To share a transaction, the contexts must share both a <code class="docutils literal"><span class="pre">DbConnection</span></code> and a <code class="docutils literal"><span class="pre">DbTransaction</span></code>.</p>
<div class="section" id="allow-connection-to-be-externally-provided">
<h3><a class="toc-backref" href="#id6">Allow connection to be externally provided</a><a class="headerlink" href="#allow-connection-to-be-externally-provided" title="–°—Å—ã–ª–∫–∞ –Ω–∞ —ç—Ç–æ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫">¬∂</a></h3>
<p>Sharing a <code class="docutils literal"><span class="pre">DbConnection</span></code> requires the ability to pass a connection into a context when constructing it.</p>
<p>The easiest way to allow <code class="docutils literal"><span class="pre">DbConnection</span></code> to be externally provided, is to stop using the <code class="docutils literal"><span class="pre">DbContext.OnConfiguring</span></code> method to configure the context and externally create <code class="docutils literal"><span class="pre">DbContextOptions</span></code> and pass them to the context constructor.</p>
<div class="admonition tip">
<p class="first admonition-title">–°–æ–≤–µ—Ç</p>
<p class="last"><code class="docutils literal"><span class="pre">DbContextOptionsBuilder</span></code> is the API you used in <code class="docutils literal"><span class="pre">DbContext.OnConfiguring</span></code> to configure the context, you are now going to use it externally to create <code class="docutils literal"><span class="pre">DbContextOptions</span></code>.</p>
</div>
<div class="highlight-c#"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span>        <span class="k">public</span> <span class="k">class</span> <span class="nc">BloggingContext</span> <span class="p">:</span> <span class="n">DbContext</span>
        <span class="p">{</span>
<span class="hll">            <span class="k">public</span> <span class="nf">BloggingContext</span><span class="p">(</span><span class="n">DbContextOptions</span><span class="p">&lt;</span><span class="n">BloggingContext</span><span class="p">&gt;</span> <span class="n">options</span><span class="p">)</span>
</span><span class="hll">                <span class="p">:</span> <span class="k">base</span><span class="p">(</span><span class="n">options</span><span class="p">)</span>
</span><span class="hll">            <span class="p">{</span> <span class="p">}</span>
</span>
            <span class="k">public</span> <span class="n">DbSet</span><span class="p">&lt;</span><span class="n">Blog</span><span class="p">&gt;</span> <span class="n">Blogs</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>An alternative is to keep using <code class="docutils literal"><span class="pre">DbContext.OnConfiguring</span></code>, but accept a <code class="docutils literal"><span class="pre">DbConnection</span></code> that is saved and then used in <code class="docutils literal"><span class="pre">DbContext.OnConfiguring</span></code>.</p>
<div class="highlight-c#"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">class</span> <span class="nc">BloggingContext</span> <span class="p">:</span> <span class="n">DbContext</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="n">DbConnection</span> <span class="n">_connection</span><span class="p">;</span>

    <span class="k">public</span> <span class="nf">BloggingContext</span><span class="p">(</span><span class="n">DbConnection</span> <span class="n">connection</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="n">_connection</span> <span class="p">=</span> <span class="n">connection</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="n">DbSet</span><span class="p">&lt;</span><span class="n">Blog</span><span class="p">&gt;</span> <span class="n">Blogs</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

    <span class="k">protected</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">OnConfiguring</span><span class="p">(</span><span class="n">DbContextOptionsBuilder</span> <span class="n">optionsBuilder</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">optionsBuilder</span><span class="p">.</span><span class="n">UseSqlServer</span><span class="p">(</span><span class="n">_connection</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="share-connection-and-transaction">
<h3><a class="toc-backref" href="#id7">Share connection and transaction</a><a class="headerlink" href="#share-connection-and-transaction" title="–°—Å—ã–ª–∫–∞ –Ω–∞ —ç—Ç–æ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫">¬∂</a></h3>
<p>You can now create multiple context instances that share the same connection. Then use the <code class="docutils literal"><span class="pre">DbContext.Database.UseTransaction(DbTransaction)</span></code> API to enlist both contexts in the same transaction.</p>
<div class="highlight-c#"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="hll">            <span class="kt">var</span> <span class="n">options</span> <span class="p">=</span> <span class="k">new</span> <span class="n">DbContextOptionsBuilder</span><span class="p">&lt;</span><span class="n">BloggingContext</span><span class="p">&gt;()</span>
</span><span class="hll">                <span class="p">.</span><span class="n">UseSqlServer</span><span class="p">(</span><span class="k">new</span> <span class="n">SqlConnection</span><span class="p">(</span><span class="n">connectionString</span><span class="p">))</span>
</span><span class="hll">                <span class="p">.</span><span class="n">Options</span><span class="p">;</span>
</span>
            <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">context1</span> <span class="p">=</span> <span class="k">new</span> <span class="n">BloggingContext</span><span class="p">(</span><span class="n">options</span><span class="p">))</span>
            <span class="p">{</span>
<span class="hll">                <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">transaction</span> <span class="p">=</span> <span class="n">context1</span><span class="p">.</span><span class="n">Database</span><span class="p">.</span><span class="n">BeginTransaction</span><span class="p">())</span>
</span>                <span class="p">{</span>
                    <span class="k">try</span>
                    <span class="p">{</span>
                        <span class="n">context1</span><span class="p">.</span><span class="n">Blogs</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="k">new</span> <span class="n">Blog</span> <span class="p">{</span> <span class="n">Url</span> <span class="p">=</span> <span class="s">&quot;http://blogs.msdn.com/dotnet&quot;</span> <span class="p">});</span>
                        <span class="n">context1</span><span class="p">.</span><span class="n">SaveChanges</span><span class="p">();</span>

                        <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">context2</span> <span class="p">=</span> <span class="k">new</span> <span class="n">BloggingContext</span><span class="p">(</span><span class="n">options</span><span class="p">))</span>
                        <span class="p">{</span>
<span class="hll">                            <span class="n">context2</span><span class="p">.</span><span class="n">Database</span><span class="p">.</span><span class="n">UseTransaction</span><span class="p">(</span><span class="n">transaction</span><span class="p">.</span><span class="n">GetDbTransaction</span><span class="p">());</span>
</span>
                            <span class="kt">var</span> <span class="n">blogs</span> <span class="p">=</span> <span class="n">context2</span><span class="p">.</span><span class="n">Blogs</span>
                                <span class="p">.</span><span class="n">OrderBy</span><span class="p">(</span><span class="n">b</span> <span class="p">=&gt;</span> <span class="n">b</span><span class="p">.</span><span class="n">Url</span><span class="p">)</span>
                                <span class="p">.</span><span class="n">ToList</span><span class="p">();</span>
                        <span class="p">}</span>

<span class="hll">                        <span class="c1">// Commit transaction if all commands succeed, transaction will auto-rollback</span>
</span><span class="hll">                        <span class="c1">// when disposed if either commands fails</span>
</span><span class="hll">                        <span class="n">transaction</span><span class="p">.</span><span class="n">Commit</span><span class="p">();</span>
</span>                    <span class="p">}</span>
                    <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="c1">// TODO: Handle failure</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<div class="section" id="using-external-dbtransactions-relational-databases-only">
<h2><a class="toc-backref" href="#id8">Using external DbTransactions (relational databases only)</a><a class="headerlink" href="#using-external-dbtransactions-relational-databases-only" title="–°—Å—ã–ª–∫–∞ –Ω–∞ —ç—Ç–æ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫">¬∂</a></h2>
<p>If you are using multiple data access technologies to access a relational database, you may want to share a transaction between operations performed by these different technologies.</p>
<p>The following example, shows how to perform an ADO.NET SqlClient operation and an Entity Framework Core operation in the same transaction.</p>
<div class="highlight-c#"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33</pre></div></td><td class="code"><div class="highlight"><pre><span></span>            <span class="kt">var</span> <span class="n">connection</span> <span class="p">=</span> <span class="k">new</span> <span class="n">SqlConnection</span><span class="p">(</span><span class="n">connectionString</span><span class="p">);</span>
            <span class="n">connection</span><span class="p">.</span><span class="n">Open</span><span class="p">();</span>

<span class="hll">            <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">transaction</span> <span class="p">=</span> <span class="n">connection</span><span class="p">.</span><span class="n">BeginTransaction</span><span class="p">())</span>
</span>            <span class="p">{</span>
                <span class="k">try</span>
                <span class="p">{</span>
                    <span class="c1">// Run raw ADO.NET command in the transaction</span>
                    <span class="kt">var</span> <span class="n">command</span> <span class="p">=</span> <span class="n">connection</span><span class="p">.</span><span class="n">CreateCommand</span><span class="p">();</span>
<span class="hll">                    <span class="n">command</span><span class="p">.</span><span class="n">Transaction</span> <span class="p">=</span> <span class="n">transaction</span><span class="p">;</span>
</span>                    <span class="n">command</span><span class="p">.</span><span class="n">CommandText</span> <span class="p">=</span> <span class="s">&quot;DELETE FROM dbo.Blogs&quot;</span><span class="p">;</span>
                    <span class="n">command</span><span class="p">.</span><span class="n">ExecuteNonQuery</span><span class="p">();</span>

                    <span class="c1">// Run an EF Core command in the transaction</span>
                    <span class="kt">var</span> <span class="n">options</span> <span class="p">=</span> <span class="k">new</span> <span class="n">DbContextOptionsBuilder</span><span class="p">&lt;</span><span class="n">BloggingContext</span><span class="p">&gt;()</span>
                        <span class="p">.</span><span class="n">UseSqlServer</span><span class="p">(</span><span class="n">connection</span><span class="p">)</span>
                        <span class="p">.</span><span class="n">Options</span><span class="p">;</span>

                    <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">context</span> <span class="p">=</span> <span class="k">new</span> <span class="n">BloggingContext</span><span class="p">(</span><span class="n">options</span><span class="p">))</span>
                    <span class="p">{</span>
<span class="hll">                        <span class="n">context</span><span class="p">.</span><span class="n">Database</span><span class="p">.</span><span class="n">UseTransaction</span><span class="p">(</span><span class="n">transaction</span><span class="p">);</span>
</span>                        <span class="n">context</span><span class="p">.</span><span class="n">Blogs</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="k">new</span> <span class="n">Blog</span> <span class="p">{</span> <span class="n">Url</span> <span class="p">=</span> <span class="s">&quot;http://blogs.msdn.com/dotnet&quot;</span> <span class="p">});</span>
                        <span class="n">context</span><span class="p">.</span><span class="n">SaveChanges</span><span class="p">();</span>
                    <span class="p">}</span>

<span class="hll">                    <span class="c1">// Commit transaction if all commands succeed, transaction will auto-rollback</span>
</span><span class="hll">                    <span class="c1">// when disposed if either commands fails</span>
</span><span class="hll">                    <span class="n">transaction</span><span class="p">.</span><span class="n">Commit</span><span class="p">();</span>
</span>                <span class="p">}</span>
                <span class="k">catch</span> <span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="n">Exception</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="c1">// TODO: Handle failure</span>
                <span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="disconnected-entities.html" class="btn btn-neutral float-right" title="üîß –ù–µ—Å–≤—è–∑–∞–Ω–Ω—ã–µ –°—É—â–Ω–æ—Å—Ç–∏" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="concurrency.html" class="btn btn-neutral" title="Concurrency Conflicts" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016 Microsoft.
      –û–±–Ω–æ–≤–ª–µ–Ω–æ: –∏—é–ª. 04, 2016.

    </p>
  </div> –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ª–∏—Ü–µ–Ω–∑–∏—Ä–æ–≤–∞–Ω–∞ –ø–æ–¥ <a href="https://creativecommons.org/licenses/by-nc/3.0/">CC BY-NC 3.0</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.0.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="../_static/wedc.js"></script>
      <script type="text/javascript" src="../_static/translations.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>