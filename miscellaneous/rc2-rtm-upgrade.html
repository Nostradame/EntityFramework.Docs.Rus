

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Обновление от RC2 до RTM &mdash; Документация Entity Framework Core 1.0.0</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  

  
    <link rel="top" title="Документация Entity Framework Core 1.0.0" href="../index.html"/>
        <link rel="up" title="Разное" href="index.html"/>
        <link rel="next" title="Command Line Reference" href="cli/index.html"/>
        <link rel="prev" title="Обновление RC1 до RC2" href="rc1-rc2-upgrade.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Entity Framework Core
          

          
          </a>

          
            
            
              <div class="version">
                1.0.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../intro.html">Entity Framework Core</a></li>
<li class="toctree-l1"><a class="reference internal" href="../platforms/index.html">Приступая к работе</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modeling/index.html">Создание модели</a></li>
<li class="toctree-l1"><a class="reference internal" href="../querying/index.html">Запрос данных</a></li>
<li class="toctree-l1"><a class="reference internal" href="../saving/index.html">Сохранение данных</a></li>
<li class="toctree-l1"><a class="reference internal" href="../efcore-vs-ef6/index.html">EF Core или EF6.x</a></li>
<li class="toctree-l1"><a class="reference internal" href="../providers/index.html">Провайдеры баз данных</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Разное</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="connection-strings.html">Строка подключения</a></li>
<li class="toctree-l2"><a class="reference internal" href="logging.html">Логгирование</a></li>
<li class="toctree-l2"><a class="reference internal" href="testing.html">Тестирование InMemory</a></li>
<li class="toctree-l2"><a class="reference internal" href="configuring-dbcontext.html">Конфигурирование DbContext</a></li>
<li class="toctree-l2"><a class="reference internal" href="rc1-rc2-upgrade.html">Обновление RC1 до RC2</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Обновление от RC2 до RTM</a></li>
<li class="toctree-l2"><a class="reference internal" href="cli/index.html">Command Line Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="internals/index.html">Что внутри</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">Entity Framework Core</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="index.html">Разное</a> &raquo;</li>
      
    <li>Обновление от RC2 до RTM</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="admonition attention">
<p class="first admonition-title">Внимание</p>
<p class="last">Эта документация для EF Core. Для EF6.x и более ранних версий смотрите <a class="reference external" href="http://msdn.com/data/ef">http://msdn.com/data/ef</a>.</p>
</div>
<div class="section" id="rc2-rtm">
<h1>Обновление от RC2 до RTM<a class="headerlink" href="#rc2-rtm" title="Ссылка на этот заголовок">¶</a></h1>
<p>Эта статья содержит указания для перенесения построения приложения с пакета RC2 в 1.0.0 RTM.</p>
<div class="contents local topic" id="id1">
<p class="topic-title first"><cite>В этой статье:</cite></p>
<ul class="simple">
<li><a class="reference internal" href="#id2" id="id3">Версии пакетов</a></li>
<li><a class="reference internal" href="#maxlength" id="id4">В существующие миграции возможно понадобится добавление maxLength</a></li>
<li><a class="reference internal" href="#net-core-imports-project-json" id="id5">.NET Core: удаление &#8220;imports&#8221; из project.json</a></li>
<li><a class="reference internal" href="#uwp" id="id6">UWP: Добавление привязки перенаправления</a></li>
</ul>
</div>
<div class="section" id="id2">
<h2><a class="toc-backref" href="#id3">Версии пакетов</a><a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h2>
<p>Имена пакетов верхнего уровня, которые вы обычно должны устанавливать в приложение, не изменились в RTM.</p>
<dl class="docutils">
<dt>Вам необходимо обновить пакеты, установленные в RTM-версии:</dt>
<dd><ul class="first last simple">
<li>Пакеты времени выполнения (например <code class="docutils literal"><span class="pre">Microsoft.EntityFrameworkCore.SqlServer</span></code>) изменен с <code class="docutils literal"><span class="pre">1.0.0-rc2-final</span></code> на <code class="docutils literal"><span class="pre">1.0.0</span></code>.</li>
<li>Пакет <code class="docutils literal"><span class="pre">Microsoft.EntityFrameworkCore.Tools</span></code> изменен с <code class="docutils literal"><span class="pre">1.0.0-preview1-final</span></code> на <code class="docutils literal"><span class="pre">1.0.0-preview2-final</span></code>. Обратите внимание, что инструментарий все еще pre-release.</li>
</ul>
</dd>
</dl>
</div>
<div class="section" id="maxlength">
<h2><a class="toc-backref" href="#id4">В существующие миграции возможно понадобится добавление maxLength</a><a class="headerlink" href="#maxlength" title="Ссылка на этот заголовок">¶</a></h2>
<p>В RC2, определение столбца в миграции выглядит типа как <code class="docutils literal"><span class="pre">table.Column&lt;string&gt;(nullable:</span> <span class="pre">true)</span></code> а размер столбца берется из некоторых метаданных, которые мы храним в коде, стоящем за миграцией. В RTM, длина теперь включена в генерируемый код <code class="docutils literal"><span class="pre">table.Column&lt;string&gt;(maxLength:</span> <span class="pre">450,</span> <span class="pre">nullable:</span> <span class="pre">true)</span></code>.</p>
<p>В существующих миграциях, которые были сгенерированы перед использованием RTM, нет определенного аргумента <code class="docutils literal"><span class="pre">maxLength</span></code>. Это означает, что будет использоваться максимальная длина, поддерживаемая базой данных (<code class="docutils literal"><span class="pre">nvarchar(max)</span></code> для SQL Server). Это может быть нормально для некоторых столбцов, но столбцам, которые являются частью ключа, внешнего ключа, или индекса потребуется обновление, для включения максимальной длины. По соглашению, максимальная длина столбца для ключей, внешних ключей и индексов = 450. Если в вашей модели есть явно настроенная длина, то вы должны использовать это значение вместо нее.</p>
<p><strong>ASP.NET Identity</strong></p>
<p>Это иземнение касается проектов, которые используют ASP.NET Identity и были созданы с помощью шаблонов проектов pre-RTM. Шаблон проекта включает в себя миграцию, используемую для создания базы данных. Эту миграцию необходимо отредактировать для указания максимальной длины <code class="docutils literal"><span class="pre">256</span></code> для следующих столбцов.</p>
<blockquote>
<div><ul>
<li><dl class="first docutils">
<dt>AspNetRoles</dt>
<dd><ul class="first last simple">
<li>Name</li>
<li>NormalizedName</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>AspNetUsers</dt>
<dd><ul class="first last simple">
<li>Email</li>
<li>NormalizedEmail</li>
<li>NormalizedUserName</li>
<li>UserName</li>
</ul>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
<p>Отказ от этого изменения при применении миграции для создания базы данных приведет к следующей ошибке.</p>
<blockquote>
<div>System.Data.SqlClient.SqlException (0x80131904): Column &#8216;NormalizedName&#8217; in table &#8216;AspNetRoles&#8217; is of a type that is invalid for use as a key column in an index.</div></blockquote>
</div>
<div class="section" id="net-core-imports-project-json">
<h2><a class="toc-backref" href="#id5">.NET Core: удаление &#8220;imports&#8221; из project.json</a><a class="headerlink" href="#net-core-imports-project-json" title="Ссылка на этот заголовок">¶</a></h2>
<p>Если вы когда-то выбирали .NET Core с RC2, вам необходимо было добавлять <code class="docutils literal"><span class="pre">imports</span></code> в project.json в качестве временного решения для некоторых зависимостей EF Core, не поддерживающих .NET Standard. Теперь они могут быть удалены.</p>
<div class="highlight-json"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;frameworks&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;netcoreapp1.0&quot;</span><span class="p">:</span> <span class="p">{</span>
<span class="hll">      <span class="nt">&quot;imports&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;dnxcore50&quot;</span><span class="p">,</span> <span class="s2">&quot;portable-net451+win8&quot;</span><span class="p">]</span>
</span>    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="uwp">
<h2><a class="toc-backref" href="#id6">UWP: Добавление привязки перенаправления</a><a class="headerlink" href="#uwp" title="Ссылка на этот заголовок">¶</a></h2>
<p>Попытка запустить команды EF в проекте универсальной платформе Windows (UWP) выдаст следующую ошибку:</p>
<blockquote>
<div>System.IO.FileLoadException: Could not load file or assembly &#8216;System.IO.FileSystem.Primitives, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&#8217; or one of its dependencies. Расположение определения манифеста сборки не соответствует ссылке на сборку.</div></blockquote>
<p>Вам нужно вручную добавить привязку перенаправления UWP проекта. В корневой папке проекта создайте файл с именем <code class="docutils literal"><span class="pre">App.config</span></code>  добавьте перенаправление для правильной версии сборки.</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;configuration&gt;</span>
 <span class="nt">&lt;runtime&gt;</span>
   <span class="nt">&lt;assemblyBinding</span> <span class="na">xmlns=</span><span class="s">&quot;urn:schemas-microsoft-com:asm.v1&quot;</span><span class="nt">&gt;</span>
     <span class="nt">&lt;dependentAssembly&gt;</span>
       <span class="nt">&lt;assemblyIdentity</span> <span class="na">name=</span><span class="s">&quot;System.IO.FileSystem.Primitives&quot;</span>
                         <span class="na">publicKeyToken=</span><span class="s">&quot;b03f5f7f11d50a3a&quot;</span>
                         <span class="na">culture=</span><span class="s">&quot;neutral&quot;</span> <span class="nt">/&gt;</span>
       <span class="nt">&lt;bindingRedirect</span> <span class="na">oldVersion=</span><span class="s">&quot;4.0.0.0&quot;</span>
                        <span class="na">newVersion=</span><span class="s">&quot;4.0.1.0&quot;</span><span class="nt">/&gt;</span>
     <span class="nt">&lt;/dependentAssembly&gt;</span>
     <span class="nt">&lt;dependentAssembly&gt;</span>
       <span class="nt">&lt;assemblyIdentity</span> <span class="na">name=</span><span class="s">&quot;System.Threading.Overlapped&quot;</span>
                         <span class="na">publicKeyToken=</span><span class="s">&quot;b03f5f7f11d50a3a&quot;</span>
                         <span class="na">culture=</span><span class="s">&quot;neutral&quot;</span> <span class="nt">/&gt;</span>
       <span class="nt">&lt;bindingRedirect</span> <span class="na">oldVersion=</span><span class="s">&quot;4.0.0.0&quot;</span>
                        <span class="na">newVersion=</span><span class="s">&quot;4.0.1.0&quot;</span><span class="nt">/&gt;</span>
     <span class="nt">&lt;/dependentAssembly&gt;</span>
   <span class="nt">&lt;/assemblyBinding&gt;</span>
 <span class="nt">&lt;/runtime&gt;</span>
<span class="nt">&lt;/configuration&gt;</span>
</pre></div>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="cli/index.html" class="btn btn-neutral float-right" title="Command Line Reference" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="rc1-rc2-upgrade.html" class="btn btn-neutral" title="Обновление RC1 до RC2" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016 Microsoft.
      Обновлено: июл. 23, 2016.

    </p>
  </div> Документация лицензирована под <a href="https://creativecommons.org/licenses/by-nc/3.0/">CC BY-NC 3.0</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.0.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="../_static/wedc.js"></script>
      <script type="text/javascript" src="../_static/translations.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>